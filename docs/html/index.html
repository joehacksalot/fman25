<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "https://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" lang="en-US">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=11"/>
<meta name="generator" content="Doxygen 1.14.0"/>
<meta name="viewport" content="width=device-width, initial-scale=1"/>
<title>FMAN25 Badge Firmware: 2024 Badge Application</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<script type="text/javascript" src="clipboard.js"></script>
<link href="navtree.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="navtreedata.js"></script>
<script type="text/javascript" src="navtree.js"></script>
<script type="text/javascript" src="cookie.js"></script>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/searchdata.js"></script>
<script type="text/javascript" src="search/search.js"></script>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr id="projectrow">
  <td id="projectalign">
   <div id="projectname">FMAN25 Badge Firmware
   </div>
   <div id="projectbrief">ESP-IDF embedded firmware for interactive badge: BLE, LEDs, touch, audio, storage</div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.14.0 -->
<script type="text/javascript">
var searchBox = new SearchBox("searchBox", "search/",'.html');
</script>
<script type="text/javascript">
$(function() { codefold.init(); });
</script>
<script type="text/javascript" src="menudata.js"></script>
<script type="text/javascript" src="menu.js"></script>
<script type="text/javascript">
$(function() {
  initMenu('',true,false,'search.php','Search',true);
  $(function() { init_search(); });
});
</script>
<div id="main-nav"></div>
</div><!-- top -->
<div id="side-nav" class="ui-resizable side-nav-resizable">
  <div id="nav-tree">
    <div id="nav-tree-contents">
      <div id="nav-sync" class="sync"></div>
    </div>
  </div>
  <div id="splitbar" style="-moz-user-select:none;" 
       class="ui-resizable-handle">
  </div>
</div>
<script type="text/javascript">
$(function(){initNavTree('index.html','',''); });
</script>
<div id="container">
<div id="doc-content">
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
</div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<div id="MSearchResults">
<div class="SRPage">
<div id="SRIndex">
<div id="SRResults"></div>
<div class="SRStatus" id="Loading">Loading...</div>
<div class="SRStatus" id="Searching">Searching...</div>
<div class="SRStatus" id="NoMatches">No Matches</div>
</div>
</div>
</div>
</div>

<div><div class="header">
  <div class="headertitle"><div class="title">2024 Badge Application </div></div>
</div><!--header-->
<div class="contents">
<div class="textblock"><p><a class="anchor" id="md__2_users_2ethanpuchaty_2_repos_2badge_2fman25_2_r_e_a_d_m_e"></a></p>
<p>An interactive ESP32-based conference badge with BLE connectivity, LED control, touch sensors, and audio synthesis capabilities.</p>
<h1 class="doxsection"><a class="anchor" id="autotoc_md1"></a>
Table of Contents</h1>
<ul>
<li>Overview</li>
<li>Features</li>
<li>Hardware Requirements</li>
<li>Project Structure</li>
<li>Getting Started</li>
<li>Building and Flashing</li>
<li>Configuration</li>
<li>Architecture</li>
<li>Development</li>
<li>Troubleshooting</li>
</ul>
<h1 class="doxsection"><a class="anchor" id="autotoc_md2"></a>
Overview</h1>
<p>This project implements a feature-rich conference badge application built on the ESP-IDF framework. The badge supports interactive games, peer-to-peer communication via BLE, customizable LED patterns, touch-based controls, and audio synthesis with support for various musical compositions.</p>
<h1 class="doxsection"><a class="anchor" id="autotoc_md3"></a>
Features</h1>
<h2 class="doxsection"><a class="anchor" id="autotoc_md4"></a>
Core Functionality</h2>
<ul>
<li><b>BLE Communication</b>: Peer-to-peer connectivity and service advertising</li>
<li><b>Touch Interface</b>: Multi-touch sensor support with gesture recognition</li>
<li><b>LED Control</b>: Programmable LED sequences and patterns</li>
<li><b>Audio System</b>: Musical note synthesis and song playback</li>
<li><b>Interactive Games</b>: Multi-badge gaming capabilities</li>
<li><b>OTA Updates</b>: Over-the-air firmware update support</li>
<li><b>Battery Management</b>: Power monitoring and low-battery indicators</li>
<li><b>File Transfer</b>: BLE-based file transfer capabilities</li>
</ul>
<h2 class="doxsection"><a class="anchor" id="autotoc_md5"></a>
Badge Variants</h2>
<ul>
<li>TRON Badge</li>
<li>Reactor Badge</li>
<li>Crest Badge</li>
<li>FMAN25 Badge</li>
</ul>
<h1 class="doxsection"><a class="anchor" id="autotoc_md6"></a>
Hardware Requirements</h1>
<ul>
<li>ESP32 microcontroller</li>
<li>Touch sensors</li>
<li>LED array/matrix</li>
<li>Audio output (buzzer/speaker)</li>
<li>Battery power system</li>
<li>BLE antenna</li>
</ul>
<h1 class="doxsection"><a class="anchor" id="autotoc_md7"></a>
Project Structure</h1>
<div class="fragment"><div class="line">fman25/</div>
<div class="line">├── main/                    # Main application code</div>
<div class="line">│   ├── inc/                 # Header files</div>
<div class="line">│   │   ├── SystemState.h    # Main system state management</div>
<div class="line">│   │   ├── Song.h           # Audio/music definitions</div>
<div class="line">│   │   ├── BleControl*.h    # BLE functionality</div>
<div class="line">│   │   └── ...              # Other component headers</div>
<div class="line">│   └── src/                 # Implementation files</div>
<div class="line">│       ├── SystemState.c    # Core system logic</div>
<div class="line">│       ├── Songs.c          # Music/audio implementation</div>
<div class="line">│       └── songs/           # Individual song definitions</div>
<div class="line">├── components/              # Custom ESP-IDF components</div>
<div class="line">│   ├── console_cmds/        # Console command handlers</div>
<div class="line">│   └── ...                  # Other components</div>
<div class="line">├── managed_components/      # ESP Component Registry components</div>
<div class="line">├── CMakeLists.txt          # Build configuration</div>
<div class="line">├── sdkconfig               # ESP-IDF configuration</div>
<div class="line">└── partitions_*.csv        # Flash partition tables</div>
</div><!-- fragment --><h1 class="doxsection"><a class="anchor" id="autotoc_md8"></a>
Getting Started</h1>
<h2 class="doxsection"><a class="anchor" id="autotoc_md9"></a>
Prerequisites</h2>
<ol type="1">
<li><b>ESP-IDF</b>: Install ESP-IDF v4.0.2 or compatible version</li>
<li><b>Python</b>: Python 3.6+ with pip</li>
<li><b>Git</b>: For cloning and submodule management</li>
</ol>
<h2 class="doxsection"><a class="anchor" id="autotoc_md10"></a>
Initial Setup</h2>
<ol type="1">
<li>Clone the repository with submodules: <div class="fragment"><div class="line">git clone --recursive &lt;repository-url&gt;</div>
<div class="line">cd fman25</div>
</div><!-- fragment --></li>
<li>If already cloned, initialize submodules: <div class="fragment"><div class="line">git submodule update --init --recursive</div>
</div><!-- fragment --></li>
<li>Set up ESP-IDF environment: <div class="fragment"><div class="line">. $IDF_PATH/export.sh</div>
</div><!-- fragment --></li>
</ol>
<h1 class="doxsection"><a class="anchor" id="autotoc_md11"></a>
Building and Flashing</h1>
<h2 class="doxsection"><a class="anchor" id="autotoc_md12"></a>
Build Configuration</h2>
<ol type="1">
<li>Configure the project: <div class="fragment"><div class="line">idf.py menuconfig</div>
</div><!-- fragment --></li>
<li>Build the project: <div class="fragment"><div class="line">idf.py build</div>
</div><!-- fragment --></li>
</ol>
<h2 class="doxsection"><a class="anchor" id="autotoc_md13"></a>
Flashing</h2>
<ol type="1">
<li><b>Erase and flash</b> (recommended for first-time setup): <div class="fragment"><div class="line">idf.py -p $(ls /dev/cu.usbserial-*) erase-flash</div>
<div class="line">idf.py -p $(ls /dev/cu.usbserial-*) flash</div>
</div><!-- fragment --></li>
<li><b>Quick flash</b> (for updates): <div class="fragment"><div class="line">idf.py -p $(ls /dev/cu.usbserial-*) flash</div>
</div><!-- fragment --></li>
<li><b>All-in-one command</b>: <div class="fragment"><div class="line">idf.py -p $(ls /dev/cu.usbserial-*) erase-flash &amp;&amp; idf.py -p $(ls /dev/cu.usbserial-*) flash</div>
</div><!-- fragment --></li>
</ol>
<h2 class="doxsection"><a class="anchor" id="autotoc_md14"></a>
Monitoring</h2>
<p>Monitor serial output for debugging: </p><div class="fragment"><div class="line">idf.py -p $(ls /dev/cu.usbserial-*) monitor</div>
</div><!-- fragment --><p>Exit monitor with <span class="tt">Ctrl+]</span></p>
<h1 class="doxsection"><a class="anchor" id="autotoc_md15"></a>
Configuration</h1>
<h2 class="doxsection"><a class="anchor" id="autotoc_md16"></a>
Badge Type Selection</h2>
<p>The badge type is configured at compile time using preprocessor definitions:</p><ul>
<li><span class="tt">TRON_BADGE</span></li>
<li><span class="tt">REACTOR_BADGE</span></li>
<li><span class="tt">CREST_BADGE</span></li>
<li><span class="tt">FMAN25_BADGE</span></li>
</ul>
<h2 class="doxsection"><a class="anchor" id="autotoc_md17"></a>
Key Configuration Options</h2>
<ul>
<li><b>Touch sensitivity thresholds</b></li>
<li><b>LED brightness and patterns</b></li>
<li><b>BLE advertising parameters</b></li>
<li><b>Audio volume and synthesis settings</b></li>
<li><b>Power management settings</b></li>
</ul>
<h1 class="doxsection"><a class="anchor" id="autotoc_md18"></a>
Architecture</h1>
<h2 class="doxsection"><a class="anchor" id="autotoc_md19"></a>
System Components</h2>
<ol type="1">
<li><b>SystemState</b>: Central state machine managing badge behavior</li>
<li><b>BleControl</b>: Bluetooth Low Energy communication stack</li>
<li><b>TouchSensor</b>: Multi-touch input handling</li>
<li><b>LedControl</b>: LED pattern and sequence management</li>
<li><b>Audio System</b>: Note synthesis and song playback</li>
<li><b>InteractiveGame</b>: Multi-badge gaming logic</li>
<li><b>NotificationDispatcher</b>: Event-driven communication between components</li>
</ol>
<h2 class="doxsection"><a class="anchor" id="autotoc_md20"></a>
Event-Driven Architecture</h2>
<p>The system uses ESP-IDF's event system for loose coupling between components:</p><ul>
<li>Touch events trigger system state changes</li>
<li>BLE events handle peer communication</li>
<li>Timer events manage LED sequences and timeouts</li>
<li>Game events coordinate multi-badge interactions</li>
</ul>
<h2 class="doxsection"><a class="anchor" id="autotoc_md21"></a>
State Management</h2>
<p>The badge operates in multiple modes:</p><ul>
<li><b>Idle</b>: Low-power standby with basic LED patterns</li>
<li><b>Touch Active</b>: Responding to user input</li>
<li><b>Game Mode</b>: Interactive multi-badge games</li>
<li><b>Synth Mode</b>: Musical note synthesis</li>
<li><b>Menu Mode</b>: Configuration and settings</li>
</ul>
<h1 class="doxsection"><a class="anchor" id="autotoc_md22"></a>
Development</h1>
<h2 class="doxsection"><a class="anchor" id="autotoc_md23"></a>
Adding New Songs</h2>
<ol type="1">
<li>Create a new file in <span class="tt">main/src/songs/</span></li>
<li>Define the song structure using the <span class="tt">SongNotes</span> format</li>
<li>Add the song to the <span class="tt">pSongs</span> array in <span class="tt">Songs.c</span></li>
<li>Update the <span class="tt">Song_e</span> enum in <span class="tt">Song.h</span></li>
</ol>
<h2 class="doxsection"><a class="anchor" id="autotoc_md24"></a>
Adding New LED Patterns</h2>
<ol type="1">
<li>Implement pattern logic in the LED control system</li>
<li>Add pattern identifiers to relevant enums</li>
<li>Update the pattern selection logic</li>
</ol>
<h2 class="doxsection"><a class="anchor" id="autotoc_md25"></a>
BLE Service Extensions</h2>
<ol type="1">
<li>Define new characteristics in <span class="tt">BleControl_Service.h</span></li>
<li>Implement handlers in the appropriate service files</li>
<li>Update the service registration code</li>
</ol>
<h1 class="doxsection"><a class="anchor" id="autotoc_md26"></a>
Troubleshooting</h1>
<h2 class="doxsection"><a class="anchor" id="autotoc_md27"></a>
Common Issues</h2>
<p><b>Build Errors:</b></p><ul>
<li>Ensure ESP-IDF environment is properly sourced</li>
<li>Check that all submodules are initialized</li>
<li>Verify ESP-IDF version compatibility</li>
</ul>
<p><b>Flash Errors:</b></p><ul>
<li>Check USB connection and port permissions</li>
<li>Try different baud rates</li>
<li>Ensure badge is in download mode</li>
</ul>
<p><b>Runtime Issues:</b></p><ul>
<li>Monitor serial output for error messages</li>
<li>Check power supply stability</li>
<li>Verify hardware connections</li>
</ul>
<p><b>BLE Connection Problems:</b></p><ul>
<li>Check BLE is enabled in configuration</li>
<li>Verify peer badge compatibility</li>
<li>Monitor RSSI levels for range issues</li>
</ul>
<h2 class="doxsection"><a class="anchor" id="autotoc_md28"></a>
Debug Features</h2>
<ul>
<li>Serial console with command interface</li>
<li>LED status indicators</li>
<li>BLE service for remote debugging</li>
<li>Comprehensive logging system</li>
</ul>
<h1 class="doxsection"><a class="anchor" id="autotoc_md29"></a>
Contributing</h1>
<p>When contributing to this project:</p><ol type="1">
<li>Follow the existing code style and naming conventions</li>
<li>Add appropriate documentation for new features</li>
<li>Test on actual hardware when possible</li>
<li>Update this README for significant changes</li>
</ol>
<h1 class="doxsection"><a class="anchor" id="autotoc_md30"></a>
License</h1>
<p>[Add license information here] </p>
</div></div><!-- PageDoc -->
<a href="doxygen_crawl.html"></a>
</div><!-- contents -->
</div><!-- doc-content -->
</div><!-- container -->
<!-- start footer part -->
<div id="nav-path" class="navpath"><!-- id is needed for treeview function! -->
  <ul>
    <li class="footer">Generated by <a href="https://www.doxygen.org/index.html"><img class="footer" src="doxygen.svg" width="104" height="31" alt="doxygen"/></a> 1.14.0 </li>
  </ul>
</div>
</body>
</html>
